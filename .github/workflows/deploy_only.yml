name: Deploy Website Only (No AI)

on:
  push:
    paths:
      - 'website/**'  # websiteフォルダ以下の変更時のみ起動
  workflow_dispatch:  # 手動ボタンでも実行可能

jobs:
  deploy-site:
    runs-on: ubuntu-latest
    permissions:
      contents: write # gh-pagesブランチへの書き込み権限

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'
          extended: true

      # テーマがリポジトリに含まれていない場合の保険（cloneする）
      - name: Ensure Theme Exists
        run: |
          if [ ! -d "website/themes/PaperMod/layouts" ]; then
            echo "Theme not found. Cloning PaperMod..."
            rm -rf website/themes/PaperMod
            git clone https://github.com/adityatelange/hugo-PaperMod.git website/themes/PaperMod --depth=1
          else
            echo "Theme found in repo. Skipping clone."
          fi

      - name: Build Website
        working-directory: ./website
        run: hugo --minify

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./website/public
